//
// USB peripheral registers
//

#pragma once

#include <stdint.h>

// Base registers
#define S_USB_CTRL_BASE 0x50100000
#define S_USB_DPSRAM_BASE 0x50100000
#define S_USB_REGS_BASE 0x50110000

// DPSRAM layout
#define S_USB_DPSRAM_SETUP_PACKET                                              \
  (*(volatile uint32_t *)(S_USB_DPSRAM_BASE + 0x0))

#define S_USB_DPSRAM_EP_IN_CTRL(EP_NUM)                                        \
  (*(volatile uint32_t *)(S_USB_DPSRAM_BASE + (EP_NUM * 8) + 0x08))
#define S_USB_DPSRAM_EP_OUT_CTRL(EP_NUM)                                       \
  (*(volatile uint32_t *)(S_USB_DPSRAM_BASE + (EP_NUM * 8) + 0xc))

#define S_USB_DPSRAM_EP_IN_BUFF_CTRL(EP_NUM)                                   \
  (*(volatile uint32_t *)(S_USB_DPSRAM_BASE + (EP_NUM * 8) + 0x80))
#define S_USB_DPSRAM_EP_OUT_BUFF_CTRL(EP_NUM)                                  \
  (*(volatile uint32_t *)(S_USB_DPSRAM_BASE + (EP_NUM * 8) + 0x84))

// USB registers bit definitions

// 0x40
typedef union {
  struct {
    uint32_t controller_en : 1;
    uint32_t host_ndevice : 1;
    uint32_t : 30;
  };
  uint32_t raw;
} s_usb_reg_main_ctrl_t;

// 0x4c
typedef union {
  struct {
    31 ep0_int_stall 30 ep0_double_buf 29 ep0_int_1buf 28 ep0_int_2buf 27 ep0_int_nak 26 direct_en 25 direct_dp 24 direct_dm 23 18 transceiver_pd 17 rpu_opt 16 pullup_en 15 pulldown_en 14 reserved 13 reset_bus 12 resume 11 vbus_en 10 keep_alive_en 9 sof_en 8 sof_sync 7 reserved 6 preamble_en 5 reserved 4 stop_trans 3 receive_data 2 send_data
  };
} s_usb_reg_sie_ctrl_t;

// USB registers
#define S_USB_REG_ADDR_ENDP (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x00))
#define S_USB_REG_ADDR_ENDP1 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x04))
#define S_USB_REG_ADDR_ENDP2 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x08))
#define S_USB_REG_ADDR_ENDP3 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x0c))
#define S_USB_REG_ADDR_ENDP4 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x10))
#define S_USB_REG_ADDR_ENDP5 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x14))
#define S_USB_REG_ADDR_ENDP6 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x18))
#define S_USB_REG_ADDR_ENDP7 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x1c))
#define S_USB_REG_ADDR_ENDP8 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x20))
#define S_USB_REG_ADDR_ENDP9 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x24))
#define S_USB_REG_ADDR_ENDP10 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x28))
#define S_USB_REG_ADDR_ENDP11 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x2c))
#define S_USB_REG_ADDR_ENDP12 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x30))
#define S_USB_REG_ADDR_ENDP13 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x34))
#define S_USB_REG_ADDR_ENDP14 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x38))
#define S_USB_REG_ADDR_ENDP15 (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x3c))
#define S_USB_REG_MAIN_CTRL                                                    \
  (*(volatile s_usb_reg_main_ctrl_t *)(S_USB_REGS_BASE + 0x40))
#define S_USB_REG_SOF_WR (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x44))
#define S_USB_REG_SOF_RD (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x48))
#define S_USB_REG_SIE_CTRL (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x4c))
#define S_USB_REG_SIE_STATUS (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x50))
#define S_USB_REG_INT_EP_CTRL (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x54))
#define S_USB_REG_BUFF_STATUS (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x58))
#define S_USB_REG_BUFF_CPU_SHOULD_HANDLE                                       \
  (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x5c))
#define S_USB_REG_EP_ABORT (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x60))
#define S_USB_REG_EP_ABORT_DONE (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x64))
#define S_USB_REG_EP_STALL_ARM (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x68))
#define S_USB_REG_NAK_POLL (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x6c))
#define S_USB_REG_EP_STATUS_STALL_NAK                                          \
  (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x70))
#define S_USB_REG_USB_MUXING (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x74))
#define S_USB_REG_USB_PWR (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x78))
#define S_USB_REG_USBPHY_DIRECT (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x7c))
#define S_USB_REG_USBPHY_DIRECT_OVERRIDE                                       \
  (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x80))
#define S_USB_REG_USBPHY_TRIM (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x84))
#define S_USB_REG_INTR (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x8c))
#define S_USB_REG_INTE (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x90))
#define S_USB_REG_INTF (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x94))
#define S_USB_REG_INTS (*(volatile uint32_t *)(S_USB_REGS_BASE + 0x98))
